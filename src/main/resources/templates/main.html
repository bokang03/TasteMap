<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>TasteMap</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <style>
        /* Header / logo */
        .site-header {
            background: #ffffff;
            border-bottom: 1px solid #eee;
        }
        .site-header .container-fluid {
            padding-left: 0;
            padding-right: 0;
        }
        .brand {
            font-weight: 800;
            font-size: 28px;
            letter-spacing: 0.4px;
            color: #e64a19;
            display: flex;
            align-items: center;
            padding-left: 12px;
        }
        .brand .logo-mark {
            width: 38px;
            height: 38px;
            border-radius: 6px;
            background: linear-gradient(135deg,#ff8a65,#ff7043);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 900;
            margin-right: 10px;
            font-size: 16px;
        }

        /* 기존 스타일들 */
        #search-result { position: relative; }
        #wishButton { margin-top: 12px; }
        .wish-card { margin-bottom: 24px; }

        .search-card { margin-bottom: 16px; }

        .search-image {
          width: 100%;
          height: 200px;
          object-fit: cover;
          display: block;
          border-radius: 4px;
        }

        .wish-card .row {
          align-items: stretch;
          margin-right: 0;
          margin-left: 0;
        }

        .wish-card .col-img {
          display: flex;
          padding-right: 0;
          flex: 0 0 66.6667%;
          max-width: 66.6667%;
        }

        .wish-card .col-info {
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          padding-left: 1rem;
          flex: 0 0 33.3333%;
          max-width: 33.3333%;
        }

        .wish-image {
          width: 100%;
          height: 340px;
          min-height: 260px;
          object-fit: cover;
          display: block;
          border-radius: 4px;
        }

        .info-list { margin-bottom: 0; }

        .pagination-wrap { text-align: center; margin-top: 16px; }

        @media (max-width: 992px) {
          .wish-card .col-img,
          .wish-card .col-info {
            flex-basis: 100%;
            max-width: 100%;
          }
          .wish-image {
            height: 260px;
          }
        }

        @media (max-width: 576px) {
          .search-image { height: 160px; }
          .wish-image { min-height: 160px; height: 200px; }
          .brand { font-size: 20px; padding-left: 10px; }
          .brand .logo-mark { width: 30px; height: 30px; font-size: 14px; margin-right:8px; }
        }

        .img-thumbnail { padding: 0.125rem; }
    </style>
</head>
<body>
<header class="site-header">
    <div class="container-fluid py-2 d-flex align-items-center">
        <div class="brand">
            <div class="logo-mark">T</div>
            TasteMap
        </div>
    </div>
</header>

<div class="container" id="app">
    <br/>
    <div class="row">
        <div class="col-sm-6 col-md-8">
            <input id="searchBox" v-model="query" style="height:46px" class="form-control form-control-lg" type="text" placeholder="맛집을 검색해주세요.">
        </div>
        <div class="col-sm-6 col-md-4">
            <button id="searchButton" type="button" class="btn btn-primary btn-lg" style="width:100%" @click="doSearch">검색</button>
        </div>
    </div>

    <br/>

    <div class="row" id="search-result" v-show="searchVisible">
        <div v-for="(res, idx) in searchResults" :key="idx" class="col-sm-6 col-md-4 search-card">
            <div class="card">
                <img :src="res.imageLink || 'https://via.placeholder.com/600x300?text=NO+IMAGE'" class="card-img-top search-image img-thumbnail" alt="검색결과 이미지">
                <div class="card-body">
                    <h5 class="card-title" v-text="stripTags(res.title)"></h5>
                    <p class="card-text">Category: <span v-text="stripTags(res.category)"></span></p>
                    <p class="card-text">주소: <span v-text="stripTags(res.address)"></span></p>
                    <button class="btn btn-primary btn-sm" style="float:right" @click="addWish(res)">위시리스트 추가</button>
                </div>
            </div>
        </div>
    </div>

    <!-- pagination-wrap 삭제됨 -->

    <br/><br/><br/>

    <div class="row">
        <div class="alert alert-info col-sm-12 col-md-12 text-center">나의 맛집 리스트</div>
    </div>

    <br/>

    <div id="wish-list">
        <div v-for="wish in wishList" :key="wish.id" class="wish-card">
            <hr/>
            <div class="row">
                <div class="col-sm-6 col-md-8 col-img">
                    <img :src="wish.imageLink || 'https://via.placeholder.com/600x300?text=NO+IMAGE'" alt="위시리스트 이미지" class="wish-image img-thumbnail">
                </div>
                <div class="col-sm-6 col-md-4 col-info">
                    <ul class="list-group list-group-flush info-list">
                        <li class="list-group-item">장소 : <span v-text="stripTags(wish.title)"></span></li>
                        <li class="list-group-item">Category : <span v-text="stripTags(wish.category)"></span></li>
                        <li class="list-group-item">주소 : <span v-text="stripTags(wish.address)"></span></li>
                        <li class="list-group-item">도로명 : <span v-text="stripTags(wish.roadAddress)"></span></li>
                    </ul>
                    <div>
                        <button @click="deleteWish(wish.id)" type="button" class="btn btn-danger btn-lg" style="width:100%;">위시리스트 삭제</button>
                    </div>
                </div>
            </div>
            <hr/>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

<script>
    new Vue({
      el: '#app',
      data: {
        query: '',
        searchResults: [],
        searchVisible: false,
        wishList: []
      },
      methods: {
        stripTags: function (s) {
          if (!s) return '';
          return s.replace(/<[^>]*>/g, '');
        },
        doSearch: function () {
          var q = (this.query || '').trim();
          if (!q) return;
          var self = this;
          $.get('/taste-map/search', { query: q })
            .done(function (response) {
              self.searchResults = Array.isArray(response) ? response : (response ? [response] : []);
              self.searchVisible = self.searchResults.length > 0;
            })
            .fail(function (xhr, status, err) {
              console.error('검색 실패', status, err);
              self.searchResults = [];
              self.searchVisible = false;
            });
        },
        addWish: function (item) {
          var payload = item || {};
          if (!payload || !payload.title) {
            console.warn('저장할 검색 결과가 없습니다.');
            return;
          }
          var self = this;
          $.ajax({
            type: 'POST',
            url: '/taste-map',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: function () { self.getWishList(); },
            error: function (xhr, status, err) { console.error('저장 실패', status, err); }
          });
        },
        getWishList: function () {
          var self = this;
          $.get('/taste-map/find-all')
            .done(function (response) { self.wishList = response || []; })
            .fail(function (xhr, status, err) { console.error('위시리스트 조회 실패', status, err); self.wishList = []; });
        },
        deleteWish: function (id) {
          var self = this;
          if (!confirm('정말 삭제하시겠습니까?')) return;
          $.ajax({
            type: 'DELETE',
            url: '/taste-map/' + id,
            success: function () { self.getWishList(); },
            error: function (xhr, status, err) { console.error('삭제 실패', status, err); }
          });
        }
      },
      mounted: function () {
        this.getWishList();
      }
    });
</script>
</body>
</html>
