<!doctype html>
<!-- language: html -->
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>맛집 WISH LIST</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <style>
        #search-result { position: relative; }
        #wishButton { margin-top: 12px; }
        .wish-card { margin-bottom: 16px; }
    </style>
</head>
<body>
<div class="container" id="app">
    <br/>
    <!-- search -->
    <div class="row">
        <div class="col-sm-6 col-md-8">
            <input id="searchBox" v-model="query" style="height:46px" class="form-control form-control-lg" type="text" placeholder="맛집을 검색해주세요 ex.(판교 갈비집)">
        </div>
        <div class="col-sm-6 col-md-4">
            <button id="searchButton" type="button" class="btn btn-primary btn-lg" style="width:100%" @click="doSearch">검색</button>
        </div>
    </div>

    <br/>

    <!-- search result -->
    <div class="row" id="search-result" v-show="searchVisible">
        <div class="col-sm-6 col-md-8">
            <img id="wish_image" :src="searchResult.imageLink" alt="..." class="img-thumbnail" style="min-width:100%; min-height:100%;">
        </div>
        <div class="col-sm-6 col-md-4">
            <ul class="list-group list-group-flush">
                <li class="list-group-item" id="title"><span v-text="searchResult.title"></span></li>
                <li class="list-group-item" id="category"><span v-text="searchResult.category"></span></li>
                <li class="list-group-item" id="address"><span v-text="searchResult.address"></span></li>
                <li class="list-group-item" id="roadAddress"><span v-text="searchResult.roadAddress"></span></li>
                <li class="list-group-item"><a id="wish_link" target="_blank" :href="searchResult.homePageLink">홈페이지</a></li>
            </ul>
            <button id="wishButton" type="button" class="btn btn-primary btn-lg" style="width:96%; position:absolute; bottom:0" @click="addWish">위시리스트 추가</button>
        </div>
    </div>

    <br/><br/><br/>

    <div class="row">
        <div class="alert alert-info col-sm-12 col-md-12 text-center">나의 맛집 리스트</div>
    </div>

    <br/>

    <!-- wish-list -->
    <div id="wish-list">
        <div v-for="wish in wishList" :key="wish.id" class="wish-card">
            <hr/>
            <div class="row">
                <div class="col-sm-6 col-md-8">
                    <img :src="wish.imageLink" alt="..." class="img-thumbnail" style="min-width:100%; min-height:100%;">
                </div>
                <div class="col-sm-6 col-md-4">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">장소 : <span v-text="wish.title"></span></li>
                        <li class="list-group-item">Category : <span v-text="wish.category"></span></li>
                        <li class="list-group-item">주소 : <span v-text="wish.address"></span></li>
                        <li class="list-group-item">도로명 : <span v-text="wish.roadAddress"></span></li>
                        <li class="list-group-item"><a :href="wish.homePageLink" target="_blank">홈페이지</a></li>
                        <li class="list-group-item">
                            <button @click="deleteWish(wish.id)" type="button" class="btn btn-danger btn-lg" style="width:100%;">위시리스트 삭제</button>
                        </li>
                    </ul>
                </div>
            </div>
            <hr/>
        </div>
    </div>
</div>

<!-- 스크립트 로드 순서: jQuery -> Bootstrap -> Vue -> 앱 스크립트 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

<script>
    new Vue({
      el: '#app',
      data: {
        query: '갈비집',
        searchResult: {},
        searchVisible: false,
        wishList: []
      },
      methods: {
        doSearch: function () {
          var q = (this.query || '').trim();
          if (!q) return;
          var self = this;
          $.get('/taste-map/search', { query: q })
            .done(function (response) {
              self.searchResult = response || {};
              self.searchVisible = !!(response && response.title);
            })
            .fail(function (xhr, status, err) {
              console.error('검색 실패', status, err);
              self.searchResult = {};
              self.searchVisible = false;
            });
        },
        addWish: function () {
          var payload = this.searchResult;
          if (!payload || !payload.title) {
            console.warn('저장할 검색 결과가 없습니다.');
            return;
          }
          var self = this;
          $.ajax({
            type: 'POST',
            url: '/taste-map',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: function () {
              self.getWishList();
            },
            error: function (xhr, status, err) {
              console.error('저장 실패', status, err);
            }
          });
        },
        getWishList: function () {
          var self = this;
          $.get('/taste-map/find-all')
            .done(function (response) { self.wishList = response || []; })
            .fail(function (xhr, status, err) { console.error('위시리스트 조회 실패', status, err); self.wishList = []; });
        },
        deleteWish: function (id) {
          var self = this;
          if (!confirm('정말 삭제하시겠습니까?')) return;
          $.ajax({
            type: 'DELETE',
            url: '/taste-map/' + id,
            success: function () { self.getWishList(); },
            error: function (xhr, status, err) { console.error('삭제 실패', status, err); }
          });
        }
      },
      mounted: function () {
        this.getWishList();
      }
    });
</script>
</body>
</html>
